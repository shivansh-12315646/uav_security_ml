{% extends "base.html" %}

{% block title %}Live Detection - UAV Security ML{% endblock %}
{% block page_title %}Live UAV Threat Detection{% endblock %}

{% block extra_css %}
<style>
/* Premium Detection Styles */
.threat-indicator-large {
    width: 120px;
    height: 120px;
    margin: 0 auto;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: pulse 2s infinite;
}

.threat-indicator-large.safe {
    box-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
}

.threat-indicator-large.danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.confidence-meter {
    height: 30px;
    background: linear-gradient(90deg, #1e293b 0%, #334155 100%);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
}

.confidence-meter-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
    transition: width 1s ease-out;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.feature-section {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-left: 4px solid #667eea;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.param-hint {
    font-size: 0.85rem;
    color: #64748b;
    margin-top: 5px;
}

.param-hint strong {
    color: #10b981;
}

.param-hint .attack-range {
    color: #ef4444;
}

.btn-sample {
    transition: all 0.3s ease;
}

.btn-sample:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.detection-card-animated {
    animation: slideInUp 0.5s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform:  translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.feature-importance-bar {
    height: 25px;
    background: #1e293b;
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 10px;
}

.feature-importance-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    padding-left: 10px;
    color: white;
    font-size: 0.85rem;
    font-weight: 600;
}

.loading-skeleton {
    background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 4px;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}
</style>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Left Panel:  Advanced Detection Form -->
    <div class="col-lg-6" data-aos="fade-right">
        <div class="card shadow-lg">
            <div class="card-header bg-primary bg-gradient text-white">
                <h5 class="mb-0">
                    <i class="fas fa-drone me-2"></i> UAV Telemetry Input
                    <span class="badge bg-light text-dark float-end">10 Parameters</span>
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{% url 'detect' %}" id="detectionForm" class="needs-validation" novalidate>
                    {% csrf_token %}
                    
                    <!-- Flight Parameters Section -->
                    <div class="feature-section">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-plane-departure me-2"></i> Flight Dynamics
                        </h6>
                        
                        <div class="mb-3">
                            <label for="altitude" class="form-label fw-bold">
                                <i class="fas fa-mountain text-muted me-1"></i> Altitude (meters)
                            </label>
                            <input type="number" step="0.1" class="form-control" id="altitude" 
                                   name="altitude" required placeholder="e.g., 200" value="200"
                                   min="0" max="600">
                            <div class="param-hint">
                                <strong>Normal: </strong> 50-400m | <span class="attack-range"><strong>Attack:</strong> Erratic (0-600m)</span>
                            </div>
                            <div class="invalid-feedback">Please enter altitude between 0-600 meters</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="speed" class="form-label fw-bold">
                                <i class="fas fa-tachometer-alt text-muted me-1"></i> Speed (km/h)
                            </label>
                            <input type="number" step="0.1" class="form-control" id="speed" 
                                   name="speed" required placeholder="e. g., 45" value="45"
                                   min="0" max="150">
                            <div class="param-hint">
                                <strong>Normal:</strong> 10-80 km/h | <span class="attack-range"><strong>Attack:</strong> 0-150 km/h</span>
                            </div>
                            <div class="invalid-feedback">Please enter speed between 0-150 km/h</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="direction" class="form-label fw-bold">
                                <i class="fas fa-compass text-muted me-1"></i> Direction (degrees)
                            </label>
                            <input type="number" step="1" class="form-control" id="direction" 
                                   name="direction" required placeholder="e.g., 90" value="90"
                                   min="0" max="360">
                            <div class="param-hint">
                                <strong>Range:</strong> 0-360¬∞ | <span class="attack-range">Attacks show rapid changes</span>
                            </div>
                            <div class="invalid-feedback">Please enter direction between 0-360 degrees</div>
                        </div>
                    </div>
                    
                    <!-- Communication Metrics Section -->
                    <div class="feature-section">
                        <h6 class="text-success mb-3">
                            <i class="fas fa-broadcast-tower me-2"></i> Communication & Navigation
                        </h6>
                        
                        <div class="mb-3">
                            <label for="signal_strength" class="form-label fw-bold">
                                <i class="fas fa-signal text-muted me-1"></i> Signal Strength (%)
                            </label>
                            <input type="number" step="1" class="form-control" id="signal_strength" 
                                   name="signal_strength" required placeholder="e.g., 85" value="85"
                                   min="0" max="100">
                            <div class="param-hint">
                                <strong>Normal:</strong> 70-100% | <span class="attack-range"><strong>Jamming:</strong> 0-30%</span>
                            </div>
                            <div class="invalid-feedback">Please enter signal strength 0-100%</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="distance_from_base" class="form-label fw-bold">
                                <i class="fas fa-ruler text-muted me-1"></i> Distance from Base (meters)
                            </label>
                            <input type="number" step="1" class="form-control" id="distance_from_base" 
                                   name="distance_from_base" required placeholder="e.g., 2500" value="2500"
                                   min="0" max="10000">
                            <div class="param-hint">
                                <strong>Normal:</strong> 0-5000m | <span class="attack-range">Long distance may indicate hijacking</span>
                            </div>
                            <div class="invalid-feedback">Please enter distance 0-10000 meters</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="gps_accuracy" class="form-label fw-bold">
                                <i class="fas fa-satellite-dish text-muted me-1"></i> GPS Accuracy (%)
                            </label>
                            <input type="number" step="1" class="form-control" id="gps_accuracy" 
                                   name="gps_accuracy" required placeholder="e.g., 90" value="90"
                                   min="0" max="100">
                            <div class="param-hint">
                                <strong>Normal:</strong> 80-100% | <span class="attack-range"><strong>Spoofing:</strong> 10-50%</span>
                            </div>
                            <div class="invalid-feedback">Please enter GPS accuracy 0-100%</div>
                        </div>
                    </div>
                    
                    <!-- System Status Section -->
                    <div class="feature-section">
                        <h6 class="text-warning mb-3">
                            <i class="fas fa-cogs me-2"></i> System Health
                        </h6>
                        
                        <div class="mb-3">
                            <label for="flight_time" class="form-label fw-bold">
                                <i class="fas fa-clock text-muted me-1"></i> Flight Time (seconds)
                            </label>
                            <input type="number" step="1" class="form-control" id="flight_time" 
                                   name="flight_time" required placeholder="e. g., 1800" value="1800"
                                   min="0" max="7200">
                            <div class="param-hint">
                                <strong>Normal:</strong> 60-3600s | <span class="attack-range"><strong>Suspicious:</strong> 0-600s (short sessions)</span>
                            </div>
                            <div class="invalid-feedback">Please enter flight time 0-7200 seconds</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="battery_level" class="form-label fw-bold">
                                <i class="fas fa-battery-three-quarters text-muted me-1"></i> Battery Level (%)
                            </label>
                            <input type="number" step="1" class="form-control" id="battery_level" 
                                   name="battery_level" required placeholder="e.g., 75" value="75"
                                   min="0" max="100">
                            <div class="param-hint">
                                <strong>Normal:</strong> 30-100% | <span class="attack-range"><strong>Tampering:</strong> Rapid drain (0-40%)</span>
                            </div>
                            <div class="invalid-feedback">Please enter battery level 0-100%</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="temperature" class="form-label fw-bold">
                                <i class="fas fa-thermometer-half text-muted me-1"></i> Temperature (¬∞C)
                            </label>
                            <input type="number" step="0.1" class="form-control" id="temperature" 
                                   name="temperature" required placeholder="e.g., 25" value="25"
                                   min="-20" max="60">
                            <div class="param-hint">
                                <strong>Normal:</strong> 15-35¬∞C | <span class="attack-range"><strong>Overheat:</strong> 40-60¬∞C</span>
                            </div>
                            <div class="invalid-feedback">Please enter temperature -20 to 60¬∞C</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="vibration" class="form-label fw-bold">
                                <i class="fas fa-wave-square text-muted me-1"></i> Vibration Level (0-10)
                            </label>
                            <input type="number" step="0.1" class="form-control" id="vibration" 
                                   name="vibration" required placeholder="e.g., 1.5" value="1.5"
                                   min="0" max="10">
                            <div class="param-hint">
                                <strong>Normal: </strong> 0-3 | <span class="attack-range"><strong>Tampering:</strong> 7-10 (physical interference)</span>
                            </div>
                            <div class="invalid-feedback">Please enter vibration level 0-10</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg shadow" id="detectButton">
                            <i class="fas fa-brain me-2"></i>
                            <span id="buttonText">Analyze with ML Model</span>
                        </button>
                        
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-success btn-sample" onclick="fillSampleData('normal')">
                                <i class="fas fa-check-circle me-1"></i> Normal Flight
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sample" onclick="fillSampleData('gps_spoofing')">
                                <i class="fas fa-satellite-dish me-1"></i> GPS Spoofing
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sample" onclick="fillSampleData('jamming')">
                                <i class="fas fa-wifi me-1"></i> Jamming
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Feature Info Card -->
        <div class="card mt-3" data-aos="fade-up">
            <div class="card-header bg-info bg-opacity-10">
                <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i> Quick Tips</h6>
            </div>
            <div class="card-body">
                <ul class="mb-0 small">
                    <li>Use <strong>sample buttons</strong> to test different attack scenarios</li>
                    <li><strong>GPS Spoofing: </strong> Low GPS accuracy, erratic altitude/speed</li>
                    <li><strong>Jamming: </strong> Weak signal, degraded GPS, high vibration</li>
                    <li><strong>Physical Tampering:</strong> Extreme vibration, overheating</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Right Panel:  Results & Visualization -->
    <div class="col-lg-6" data-aos="fade-left">
        {% if prediction %}
        <!-- Detection Result Card -->
        <div class="card shadow-lg {% if prediction.prediction == 'Normal' %}border-success{% else %}border-danger{% endif %} detection-card-animated" id="resultCard">
            <div class="card-header {% if prediction.prediction == 'Normal' %}bg-success{% else %}bg-danger{% endif %} bg-gradient text-white">
                <h5 class="mb-0">
                    <i class="fas {% if prediction.prediction == 'Normal' %}fa-shield-check{% else %}fa-exclamation-triangle{% endif %} me-2"></i> 
                    Analysis Complete
                </h5>
            </div>
            <div class="card-body">
                <!-- Threat Indicator -->
                <div class="text-center mb-4">
                    <div class="threat-indicator-large {% if prediction.prediction == 'Normal' %}safe{% else %}danger{% endif %}">
                        <i class="fas {% if prediction.prediction == 'Normal' %}fa-shield-alt{% else %}fa-skull-crossbones{% endif %} fa-4x text-white"></i>
                    </div>
                    <h2 class="mt-3 fw-bold {% if prediction.prediction == 'Normal' %}text-success{% else %}text-danger{% endif %}">
                        {% if prediction.prediction == 'Normal' %}
                            SAFE - Normal Operation
                        {% else %}
                            ‚ö†Ô∏è {{ prediction.prediction }} Detected!
                        {% endif %}
                    </h2>
                    <p class="text-muted">
                        {% if prediction.prediction == 'Normal' %}All UAV parameters within normal ranges{% else %}Anomalous behavior detected in UAV telemetry{% endif %}
                    </p>
                </div>
                
                <!-- Confidence Meter -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0"><i class="fas fa-percentage me-2"></i>Model Confidence</h6>
                        <span class="badge {% if prediction.confidence > 0.9 %}bg-success{% elif prediction.confidence > 0.7 %}bg-warning{% else %}bg-secondary{% endif %} fs-6">
                            {% widthratio prediction.confidence 1 100 %}%
                        </span>
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar {% if prediction.prediction == 'Normal' %}bg-success{% else %}bg-danger{% endif %} progress-bar-striped progress-bar-animated" 
                             role="progressbar" 
                             style="width: {% widthratio prediction.confidence 1 100 %}%"
                             aria-valuenow="{% widthratio prediction.confidence 1 100 %}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            {% widthratio prediction.confidence 1 100 %}%
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted">Low Confidence</small>
                        <small class="text-muted">High Confidence</small>
                    </div>
                </div>
                
                <!-- Detection Metadata -->
                <div class="card bg-light border-0 mb-3">
                    <div class="card-body">
                        <h6 class="mb-3"><i class="fas fa-info-circle me-2 text-primary"></i> Detection Details</h6>
                        <div class="row g-2">
                            <div class="col-6">
                                <small class="text-muted d-block">Threat Level</small>
                                <span class="badge {% if prediction.threat_level == 'Low' %}bg-success{% elif prediction.threat_level == 'Medium' %}bg-warning{% elif prediction.threat_level == 'High' %}bg-danger{% else %}bg-dark{% endif %} fs-6">
                                    {{ prediction.threat_level|upper }}
                                </span>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">ML Algorithm</small>
                                <strong class="text-primary">{{ prediction.model_used }}</strong>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">Detection ID</small>
                                <code class="bg-dark text-white px-2 py-1 rounded">#{{ prediction.detection_id }}</code>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">Timestamp</small>
                                <span class="fw-bold">Just now</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Alert -->
                {% if prediction.prediction != 'Normal' %}
                <div class="alert alert-danger border-danger" role="alert" data-aos="pulse">
                    <h6 class="alert-heading fw-bold">
                        <i class="fas fa-exclamation-triangle me-2"></i> Security Protocol Activated
                    </h6>
                    <p class="mb-2">Potential security threat identified. Immediate review required.</p>
                    <hr>
                    <p class="mb-2 fw-bold">Recommended Actions:</p>
                    <ul class="mb-0 small">
                        <li>Verify UAV GPS coordinates against ground truth</li>
                        <li>Check signal integrity and communication logs</li>
                        <li>Inspect for physical tampering if vibration is abnormal</li>
                        <li>Consider emergency landing if critical threat confirmed</li>
                        <li>Document incident for security review</li>
                    </ul>
                </div>
                {% else %}
                <div class="alert alert-success border-success" role="alert" data-aos="pulse">
                    <h6 class="alert-heading fw-bold">
                        <i class="fas fa-check-double me-2"></i> System Status:  Nominal
                    </h6>
                    <p class="mb-2">UAV operating within normal parameters. No threats detected.</p>
                    <hr>
                    <ul class="mb-0 small">
                        <li>All telemetry data within expected ranges</li>
                        <li>Communication integrity verified</li>
                        <li>Continue standard monitoring protocols</li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Feature Contribution (Mock) -->
        <div class="card mt-3 shadow" data-aos="fade-up" data-aos-delay="100">
            <div class="card-header bg-secondary bg-opacity-10">
                <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i> Top Contributing Features</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <small class="text-muted">GPS Accuracy</small>
                    <div class="feature-importance-bar">
                        <div class="feature-importance-fill" style="width: 85%;">85%</div>
                    </div>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Signal Strength</small>
                    <div class="feature-importance-bar">
                        <div class="feature-importance-fill" style="width: 72%;">72%</div>
                    </div>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Vibration Level</small>
                    <div class="feature-importance-bar">
                        <div class="feature-importance-fill" style="width: 58%;">58%</div>
                    </div>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Temperature</small>
                    <div class="feature-importance-bar">
                        <div class="feature-importance-fill" style="width: 45%;">45%</div>
                    </div>
                </div>
                <small class="text-muted d-block mt-2">
                    <i class="fas fa-info-circle me-1"></i> Features most influential in this prediction
                </small>
            </div>
        </div>
        
        {% else %}
        <!-- Instructions Card (No Prediction Yet) -->
        <div class="card shadow-lg">
            <div class="card-header bg-info bg-gradient text-white">
                <h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i> How to Use This System</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4 py-3">
                    <i class="fas fa-drone fa-6x text-primary opacity-25"></i>
                    <h4 class="mt-3 text-primary">UAV Threat Detection System</h4>
                    <p class="text-muted">AI-powered security analysis for unmanned aerial vehicles</p>
                </div>
                
                <h6 class="fw-bold mb-3"><i class="fas fa-list-ol me-2 text-primary"></i> Step-by-Step Guide: </h6>
                <div class="list-group list-group-flush mb-4">
                    <div class="list-group-item d-flex align-items-start">
                        <span class="badge bg-primary rounded-circle me-3" style="width: 30px; height: 30px; line-height: 22px;">1</span>
                        <div>
                            <strong>Enter UAV Data</strong>
                            <p class="mb-0 small text-muted">Fill in all 10 telemetry parameters from your UAV system</p>
                        </div>
                    </div>
                    <div class="list-group-item d-flex align-items-start">
                        <span class="badge bg-primary rounded-circle me-3" style="width: 30px; height:  30px; line-height:  22px;">2</span>
                        <div>
                            <strong>Run ML Analysis</strong>
                            <p class="mb-0 small text-muted">Click "Analyze with ML Model" to process the data</p>
                        </div>
                    </div>
                    <div class="list-group-item d-flex align-items-start">
                        <span class="badge bg-primary rounded-circle me-3" style="width: 30px; height: 30px; line-height: 22px;">3</span>
                        <div>
                            <strong>Review Results</strong>
                            <p class="mb-0 small text-muted">Check the threat prediction and confidence score</p>
                        </div>
                    </div>
                    <div class="list-group-item d-flex align-items-start">
                        <span class="badge bg-primary rounded-circle me-3" style="width: 30px; height:  30px; line-height:  22px;">4</span>
                        <div>
                            <strong>Take Action</strong>
                            <p class="mb-0 small text-muted">Follow recommended security protocols if threat detected</p>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info border-info">
                    <h6 class="alert-heading fw-bold"><i class="fas fa-flask me-2"></i> Try Sample Data</h6>
                    <p class="mb-0 small">Use the preset buttons to quickly test the system with realistic attack scenarios</p>
                </div>
                
                <h6 class="fw-bold mb-3 mt-4"><i class="fas fa-shield-virus me-2 text-danger"></i> Detectable Attack Types: </h6>
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-light">
                            <tr>
                                <th><i class="fas fa-virus me-1"></i> Attack</th>
                                <th><i class="fas fa-fingerprint me-1"></i> Signature</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong class="text-danger">GPS Spoofing</strong></td>
                                <td><small>GPS accuracy <30%, erratic altitude/speed</small></td>
                            </tr>
                            <tr>
                                <td><strong class="text-warning">Jamming</strong></td>
                                <td><small>Signal <30%, GPS degraded, high vibration</small></td>
                            </tr>
                            <tr>
                                <td><strong class="text-info">Unauthorized Access</strong></td>
                                <td><small>Unexpected direction, abnormal speed patterns</small></td>
                            </tr>
                            <tr>
                                <td><strong class="text-secondary">Physical Tampering</strong></td>
                                <td><small>Vibration >7, temperature >40¬∞C, battery drain</small></td>
                            </tr>
                            <tr>
                                <td><strong class="text-success">Normal Operation</strong></td>
                                <td><small>All parameters within safe ranges</small></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="alert alert-warning border-warning mt-3">
                    <h6 class="alert-heading fw-bold"><i class="fas fa-exclamation-circle me-2"></i> Important Note</h6>
                    <p class="mb-0 small">This system uses advanced machine learning algorithms trained on 20,000 UAV security samples with 99%+ accuracy. Always verify critical threats through multiple sources. </p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ============================================
// GLOBAL FUNCTIONS - DEFINED FIRST
// ============================================

// Fill sample data with animations
function fillSampleData(type) {
    console.log('üéØ fillSampleData called with type:', type);
    
    const form = document.getElementById('detectionForm');
    if (!form) {
        console.error('‚ùå Form not found! ');
        return;
    }
    
    const inputs = form.querySelectorAll('input[type="number"]');
    
    // Add loading effect
    inputs.forEach(input => {
        input.classList.add('loading-skeleton');
    });
    
    setTimeout(() => {
        if (type === 'normal') {
            // Normal flight pattern
            document.getElementById('altitude').value = 200;
            document.getElementById('speed').value = 45;
            document.getElementById('direction').value = 90;
            document.getElementById('signal_strength').value = 85;
            document.getElementById('distance_from_base').value = 2500;
            document.getElementById('flight_time').value = 1800;
            document.getElementById('battery_level').value = 75;
            document.getElementById('temperature').value = 25;
            document.getElementById('vibration').value = 1.5;
            document.getElementById('gps_accuracy').value = 90;
            
            showToast('‚úÖ Normal flight pattern loaded', 'success');
            
        } else if (type === 'gps_spoofing') {
            // GPS Spoofing attack - matches training data signature:
            // gps_accuracy: 5-40, altitude: 0-600, distance_from_base: 0-15000
            // Other features remain in normal ranges
            document.getElementById('altitude').value = 550;
            document.getElementById('speed').value = 45;
            document.getElementById('direction').value = 275;
            document.getElementById('signal_strength').value = 85;
            document.getElementById('distance_from_base').value = 8000;
            document.getElementById('flight_time').value = 1800;
            document.getElementById('battery_level').value = 75;
            document.getElementById('temperature').value = 25;
            document.getElementById('vibration').value = 1.5;
            document.getElementById('gps_accuracy').value = 15;
            
            showToast('‚ö†Ô∏è GPS Spoofing attack pattern loaded', 'warning');
            
        } else if (type === 'jamming') {
            // Jamming attack - matches training data signature:
            // signal_strength: 0-25, gps_accuracy: 0-30, vibration: 6-10, speed: 5-30
            document.getElementById('altitude').value = 180;
            document.getElementById('speed').value = 20;
            document.getElementById('direction').value = 90;
            document.getElementById('signal_strength').value = 15;
            document.getElementById('distance_from_base').value = 2000;
            document.getElementById('flight_time').value = 1200;
            document.getElementById('battery_level').value = 70;
            document.getElementById('temperature').value = 28;
            document.getElementById('vibration').value = 7.5;
            document.getElementById('gps_accuracy').value = 20;
            
            showToast('üö® Jamming attack pattern loaded', 'danger');
        }
        
        // Remove loading effect and trigger validation
        inputs.forEach(input => {
            input.classList.remove('loading-skeleton');
            input.dispatchEvent(new Event('input'));
            
            // Add bounce animation
            input. style.animation = 'bounce 0.5s ease';
            setTimeout(() => {
                input. style.animation = '';
            }, 500);
        });
        
        console.log('‚úÖ Sample data filled successfully');
    }, 300);
}

// Toast notification function
function showToast(message, type = 'info') {
    console.log(`üì¢ Toast: ${message} (${type})`);
    
    const toastHTML = `
        <div class="toast align-items-center text-white bg-${type} border-0 position-fixed bottom-0 end-0 m-3" role="alert" style="z-index: 9999;">
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', toastHTML);
    const toastElement = document.querySelector('.toast:last-child');
    
    // Check if Bootstrap is loaded
    if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
        const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
        toast.show();
        
        toastElement.addEventListener('hidden.bs.toast', () => {
            toastElement.remove();
        });
    } else {
        console.warn('Bootstrap Toast not available, using fallback');
        setTimeout(() => toastElement.remove(), 3000);
    }
}

// ============================================
// DOM CONTENT LOADED
// ============================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Detection page loaded - initializing.. .');
    
    // Add bounce animation styles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    `;
    document.head.appendChild(style);
    
    const form = document.getElementById('detectionForm');
    const detectButton = document.getElementById('detectButton');
    const buttonText = document.getElementById('buttonText');
    const inputs = form.querySelectorAll('input[type="number"]');
    
    console.log(`üìù Found ${inputs.length} input fields`);
    
    // Enable Bootstrap validation
    form.classList.add('was-validated');
    
    // Real-time input validation with visual feedback
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            if (this.checkValidity()) {
                this. classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        });
        
        // Add focus animation
        input.addEventListener('focus', function() {
            this.parentElement.style.transform = 'scale(1.02)';
            this.parentElement.style.transition = 'transform 0.2s ease';
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.style.transform = 'scale(1)';
        });
    });
    
    // Enhanced form submission with loading state
    form.addEventListener('submit', function(e) {
        if (! form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
            console.warn('‚ö†Ô∏è Form validation failed');
            return false;
        }
        
        console. log('üì§ Form submitted - showing loading state');
        
        // Show advanced loading state
        detectButton.disabled = true;
        detectButton. classList.add('disabled');
        buttonText.innerHTML = `
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            Analyzing UAV Telemetry...
        `;
        
        // Simulate progress (visual feedback)
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += 10;
            if (progress <= 90) {
                buttonText.innerHTML = `
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Processing... ${progress}%
                `;
            }
        }, 100);
        
        // Clear interval after form submits
        setTimeout(() => clearInterval(progressInterval), 3000);
    });
    
    // Animate confidence meter if present
    const confidenceMeter = document.querySelector('.progress-bar');
    if (confidenceMeter) {
        setTimeout(() => {
            confidenceMeter.style.transition = 'width 1. 5s ease-out';
        }, 100);
    }
    
    console.log('‚úÖ All event listeners attached successfully');
});
</script>
{% endblock %}