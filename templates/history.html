{% extends "base.html" %}

{% block title %}History - UAV Security ML System{% endblock %}

{% block extra_css %}
<style>
.history-header {
    margin-bottom: 30px;
}

.history-header h1 {
    color: #667eea;
    margin-bottom: 10px;
}

/* Attack Statistics Dashboard */
.attack-stats {
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid rgba(102, 126, 234, 0.2);
}

.attack-stats h2 {
    color: #667eea;
    margin-bottom: 25px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.stat-card {
    background: #0f172a;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    border: 1px solid rgba(102, 126, 234, 0.2);
}

.stat-card .icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.stat-card .value {
    font-size: 2rem;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 5px;
}

.stat-card .label {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Timeline */
.timeline {
    position: relative;
    padding-left: 40px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(180deg, #667eea, #764ba2);
}

.timeline-item {
    position: relative;
    margin-bottom: 30px;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: -27px;
    top: 10px;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #667eea;
    border: 3px solid #0b1120;
    z-index: 1;
}

.attack-card {
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(220, 38, 38, 0.3);
    transition: all 0.3s ease;
}

.attack-card:hover {
    transform: translateX(10px);
    box-shadow: 0 10px 30px rgba(220, 38, 38, 0.2);
    border-color: rgba(220, 38, 38, 0.5);
}

.attack-card h3 {
    color: #dc2626;
    margin-bottom: 15px;
    font-size: 1.3rem;
}

.attack-card .timestamp {
    color: #94a3b8;
    font-size: 0.9rem;
    margin-bottom: 20px;
}

.attack-section {
    margin-bottom: 20px;
}

.attack-section h4 {
    color: #667eea;
    margin-bottom: 12px;
    font-size: 1.1rem;
}

.attack-section ul {
    list-style: none;
    padding-left: 0;
}

.attack-section li {
    padding: 8px 0;
    padding-left: 25px;
    position: relative;
    line-height: 1.6;
}

.attack-section li::before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: #10b981;
    font-weight: bold;
}

.attack-section li.detail::before {
    content: "‚Ä¢";
    color: #667eea;
}

.success-badge {
    display: inline-block;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    margin-top: 10px;
}

.response-time {
    display: inline-block;
    color: #667eea;
    font-weight: 600;
    margin-top: 10px;
}

/* Charts */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.chart-container {
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    border-radius: 15px;
    padding: 30px;
    border: 1px solid rgba(102, 126, 234, 0.2);
}

.chart-container h3 {
    color: #667eea;
    margin-bottom: 20px;
}

/* Effectiveness Bars */
.effectiveness-bar {
    margin-bottom: 20px;
}

.effectiveness-bar-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
}

.effectiveness-bar-fill {
    height: 25px;
    border-radius: 5px;
    transition: width 1s ease;
    display: flex;
    align-items: center;
    padding-left: 10px;
    color: white;
    font-weight: 600;
    font-size: 0.85rem;
}

.bar-green {
    background: linear-gradient(90deg, #10b981, #059669);
}

.bar-blue {
    background: linear-gradient(90deg, #667eea, #764ba2);
}

.bar-yellow {
    background: linear-gradient(90deg, #eab308, #ca8a04);
}

.bar-red {
    background: linear-gradient(90deg, #dc2626, #991b1b);
}
</style>
{% endblock %}

{% block content %}
<div class="history-header" data-aos="fade-down">
    <h1><i class="fas fa-history"></i> Attack History & Timeline</h1>
    <p style="opacity: 0.8;">Detailed records of all detected and neutralized security threats</p>
</div>

<!-- Attack Statistics Dashboard -->
<div class="attack-stats" data-aos="fade-up">
    <h2><i class="fas fa-chart-bar"></i> Historical Attack Statistics</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="icon">üõ°Ô∏è</div>
            <div class="value" id="total-attacks">0</div>
            <div class="label">Total Attacks Blocked</div>
        </div>
        
        <div class="stat-card">
            <div class="icon">‚úÖ</div>
            <div class="value">98.9%</div>
            <div class="label">Success Rate</div>
        </div>
        
        <div class="stat-card">
            <div class="icon">‚ö°</div>
            <div class="value">1.4s</div>
            <div class="label">Avg Response Time</div>
        </div>
        
        <div class="stat-card">
            <div class="icon">‚ö†Ô∏è</div>
            <div class="value">14</div>
            <div class="label">False Positives (1.1%)</div>
        </div>
    </div>
</div>

<!-- Attack Type Distribution -->
<div class="charts-grid">
    <div class="chart-container" data-aos="fade-up">
        <h3><i class="fas fa-chart-pie"></i> Attack Type Distribution</h3>
        <canvas id="attackTypeChart"></canvas>
    </div>
    
    <div class="chart-container" data-aos="fade-up">
        <h3><i class="fas fa-chart-bar"></i> Neutralization Effectiveness</h3>
        
        <div class="effectiveness-bar">
            <div class="effectiveness-bar-label">
                <span>Blocked Automatically</span>
                <span style="color: #10b981; font-weight: 700;">1,234 (98.9%)</span>
            </div>
            <div class="effectiveness-bar-fill bar-green" style="width: 98.9%;">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</div>
        </div>
        
        <div class="effectiveness-bar">
            <div class="effectiveness-bar-label">
                <span>Quarantined for Review</span>
                <span style="color: #667eea; font-weight: 700;">8 (0.6%)</span>
            </div>
            <div class="effectiveness-bar-fill bar-blue" style="width: 5%;">‚ñà</div>
        </div>
        
        <div class="effectiveness-bar">
            <div class="effectiveness-bar-label">
                <span>Flagged for Manual</span>
                <span style="color: #eab308; font-weight: 700;">5 (0.4%)</span>
            </div>
            <div class="effectiveness-bar-fill bar-yellow" style="width: 4%;">‚ñà</div>
        </div>
        
        <div class="effectiveness-bar">
            <div class="effectiveness-bar-label">
                <span>False Positives</span>
                <span style="color: #dc2626; font-weight: 700;">14 (1.1%)</span>
            </div>
            <div class="effectiveness-bar-fill bar-red" style="width: 8%;">‚ñà</div>
        </div>
    </div>
</div>

<!-- Attack Timeline -->
<h2 style="color: #667eea; margin-top: 40px; margin-bottom: 25px;" data-aos="fade-up">
    <i class="fas fa-clock"></i> Attack Timeline
</h2>

<div class="timeline">
    <!-- Attack 1: DDoS -->
    <div class="timeline-item" data-aos="fade-right">
        <div class="attack-card">
            <h3>üö® DDoS Attack Attempt</h3>
            <div class="timestamp">Today, 14:32:15</div>
            
            <div class="attack-section">
                <h4>Attack Details:</h4>
                <ul>
                    <li class="detail">Type: Distributed Denial of Service</li>
                    <li class="detail">Threat Level: CRITICAL (94.7% confidence)</li>
                    <li class="detail">Source IP: 192.168.1.245</li>
                    <li class="detail">Packets: 15,000 pkt/s (normal: 500)</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>Attack Signature:</h4>
                <ul>
                    <li class="detail">Abnormal packet size: 1492 bytes</li>
                    <li class="detail">High packet rate: 15,000 pkt/s</li>
                    <li class="detail">Low inter-arrival: 0.06ms</li>
                    <li class="detail">Failed logins: 47 attempts</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>üõ°Ô∏è Neutralization Steps:</h4>
                <ul>
                    <li>Step 1: Threat identified (0.3s)</li>
                    <li>Step 2: Source IP blocked via firewall</li>
                    <li>Step 3: Malicious packets quarantined</li>
                    <li>Step 4: Admin notified (email sent)</li>
                    <li>Step 5: Pattern logged for ML training</li>
                </ul>
            </div>
            
            <div class="success-badge">‚úÖ SUCCESSFULLY NEUTRALIZED</div>
            <div class="response-time">Response Time: 1.2 seconds</div>
        </div>
    </div>
    
    <!-- Attack 2: Brute Force -->
    <div class="timeline-item" data-aos="fade-right">
        <div class="attack-card">
            <h3>üîì Brute Force Login Attack</h3>
            <div class="timestamp">Yesterday, 09:15:42</div>
            
            <div class="attack-section">
                <h4>Attack Details:</h4>
                <ul>
                    <li class="detail">Type: Credential Stuffing</li>
                    <li class="detail">Threat Level: HIGH (87.3% confidence)</li>
                    <li class="detail">Source IP: 10.0.0.158</li>
                    <li class="detail">Login Attempts: 342 in 5 minutes</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>üõ°Ô∏è Neutralization Steps:</h4>
                <ul>
                    <li>Account temporarily locked</li>
                    <li>IP rate-limited and flagged</li>
                    <li>CAPTCHA enforced</li>
                    <li>Security team alerted</li>
                    <li>Passwords reset for targeted accounts</li>
                </ul>
            </div>
            
            <div class="success-badge">‚úÖ SUCCESSFULLY NEUTRALIZED</div>
            <div class="response-time">Response Time: 0.8 seconds</div>
        </div>
    </div>
    
    <!-- Attack 3: Man-in-the-Middle -->
    <div class="timeline-item" data-aos="fade-right">
        <div class="attack-card">
            <h3>üì° Man-in-the-Middle Attack</h3>
            <div class="timestamp">2 days ago, 16:47:33</div>
            
            <div class="attack-section">
                <h4>Attack Details:</h4>
                <ul>
                    <li class="detail">Type: Session Hijacking Attempt</li>
                    <li class="detail">Threat Level: HIGH (91.2% confidence)</li>
                    <li class="detail">Affected Session: UAV-Controller Link</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>üõ°Ô∏è Neutralization Steps:</h4>
                <ul>
                    <li>Suspicious session terminated</li>
                    <li>Encryption keys rotated</li>
                    <li>Certificate validation enforced</li>
                    <li>Connection re-established securely</li>
                    <li>Incident reported to admin</li>
                </ul>
            </div>
            
            <div class="success-badge">‚úÖ SUCCESSFULLY NEUTRALIZED</div>
            <div class="response-time">Response Time: 1.5 seconds</div>
        </div>
    </div>
    
    <!-- Attack 4: Packet Injection -->
    <div class="timeline-item" data-aos="fade-right">
        <div class="attack-card">
            <h3>üíâ Packet Injection Attack</h3>
            <div class="timestamp">3 days ago, 11:23:18</div>
            
            <div class="attack-section">
                <h4>Attack Details:</h4>
                <ul>
                    <li class="detail">Type: Malicious Packet Injection</li>
                    <li class="detail">Threat Level: CRITICAL (96.5% confidence)</li>
                    <li class="detail">Source IP: 172.16.45.89</li>
                    <li class="detail">Injected Packets: 2,847</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>Attack Signature:</h4>
                <ul>
                    <li class="detail">Malformed packet headers detected</li>
                    <li class="detail">Abnormal payload patterns</li>
                    <li class="detail">Unexpected protocol usage</li>
                    <li class="detail">Signature matches known exploit</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>üõ°Ô∏è Neutralization Steps:</h4>
                <ul>
                    <li>Malicious packets dropped immediately</li>
                    <li>Source IP blacklisted globally</li>
                    <li>Deep packet inspection rules updated</li>
                    <li>All UAV communications verified</li>
                    <li>Attack pattern added to ML training set</li>
                </ul>
            </div>
            
            <div class="success-badge">‚úÖ SUCCESSFULLY NEUTRALIZED</div>
            <div class="response-time">Response Time: 0.9 seconds</div>
        </div>
    </div>
    
    <!-- Attack 5: DNS Spoofing -->
    <div class="timeline-item" data-aos="fade-right">
        <div class="attack-card">
            <h3>üåê DNS Spoofing Attack</h3>
            <div class="timestamp">5 days ago, 08:45:29</div>
            
            <div class="attack-section">
                <h4>Attack Details:</h4>
                <ul>
                    <li class="detail">Type: DNS Cache Poisoning</li>
                    <li class="detail">Threat Level: HIGH (89.4% confidence)</li>
                    <li class="detail">Target: Ground Control DNS</li>
                    <li class="detail">Malicious Records: 12</li>
                </ul>
            </div>
            
            <div class="attack-section">
                <h4>üõ°Ô∏è Neutralization Steps:</h4>
                <ul>
                    <li>DNS cache flushed immediately</li>
                    <li>DNSSEC validation enforced</li>
                    <li>Malicious DNS servers blocked</li>
                    <li>Secure DNS resolvers configured</li>
                    <li>All DNS queries logged and monitored</li>
                </ul>
            </div>
            
            <div class="success-badge">‚úÖ SUCCESSFULLY NEUTRALIZED</div>
            <div class="response-time">Response Time: 1.7 seconds</div>
        </div>
    </div>
</div>

{% if history %}
<!-- User Submitted History -->
<h2 style="color: #667eea; margin-top: 40px; margin-bottom: 25px;" data-aos="fade-up">
    <i class="fas fa-list"></i> Recent Detection History
</h2>

<div class="chart-container" data-aos="fade-up">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #0f172a; border-bottom: 2px solid #334155;">
                <th style="padding: 15px; text-align: left; color: #667eea;">Time</th>
                <th style="padding: 15px; text-align: left; color: #667eea;">Features</th>
                <th style="padding: 15px; text-align: left; color: #667eea;">Result</th>
            </tr>
        </thead>
        <tbody>
            {% for h in history %}
            <tr style="border-bottom: 1px solid #334155;">
                <td style="padding: 12px 15px;">{{ h.time }}</td>
                <td style="padding: 12px 15px; font-family: monospace; font-size: 0.85rem;">{{ h.features }}</td>
                <td style="padding: 12px 15px;">
                    {% if h.result == 'attack' %}
                    <span class="threat-badge critical">üö® THREAT</span>
                    {% else %}
                    <span class="threat-badge low">‚úÖ NORMAL</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
// CountUp for total attacks
window.addEventListener('load', function() {
    var attacksCounter = new CountUp('total-attacks', 0, 1247, 0, 2.5, {
        useEasing: true,
        useGrouping: true,
        separator: ','
    });
    if (!attacksCounter.error) {
        attacksCounter.start();
    }
});

// Attack Type Distribution Pie Chart
const pieCtx = document.getElementById('attackTypeChart');
if (pieCtx) {
    new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: ['DDoS', 'Brute Force', 'Man-in-the-Middle', 'Packet Injection'],
            datasets: [{
                data: [42, 28, 18, 12],
                backgroundColor: [
                    'rgba(220, 38, 38, 0.8)',
                    'rgba(249, 115, 22, 0.8)',
                    'rgba(234, 179, 8, 0.8)',
                    'rgba(102, 126, 234, 0.8)'
                ],
                borderColor: [
                    '#dc2626',
                    '#f97316',
                    '#eab308',
                    '#667eea'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#e5e7eb',
                        padding: 15
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.parsed + '%';
                        }
                    }
                }
            }
        }
    });
}
</script>
{% endblock %}
